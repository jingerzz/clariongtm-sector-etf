

# 1. Remove Volume Data from ETF Tiles

**What changes:** In `src/components/ETFCard.tsx`, remove the volume display (the "Vol" label, formatted volume number, and volume % change) from the RSI & Volume row. The row will show only RSI data. Also remove the now-unused `formatVolume` helper function and the `volChange` variable.

**Lines affected:** Remove lines 30-35 (`formatVolume`), line 39 (`volChange`), and lines 83-94 (the Vol section inside the RSI row).

---

# 2. Fix Broken News Feed Links

**Problem:** The news URLs are generated by the Perplexity AI model and are often hallucinated -- they point to non-existent articles. This is a known limitation of AI-generated citations.

**Solution:** Update the `fetch-etf-news` backend function's prompt to explicitly instruct Perplexity to use its citation/search capabilities and return only verified, real URLs. Additionally, add a `return_citations` or `search_domain_filter` parameter if the Perplexity API supports it. Since the edge function source isn't in the repo, we'll need to recreate it with the improved prompt.

**Approach:**
- Locate or recreate the `fetch-etf-news` edge function with an updated system prompt that emphasizes returning only real, verifiable source URLs
- Use Perplexity's `search_domain_filter` to restrict to known financial news domains (reuters.com, cnbc.com, bloomberg.com, wsj.com, etc.)
- Add a `return_citations: true` parameter to the API call so Perplexity returns its actual search citations rather than hallucinated URLs
- Map the returned citations to each news item so links point to real articles

**Files modified:**
| File | Change |
|------|--------|
| `src/components/ETFCard.tsx` | Remove volume display and unused helpers |
| `supabase/functions/fetch-etf-news/index.ts` | Update Perplexity API call to use citations for real URLs |

## Technical Details

### ETFCard.tsx changes
- Delete `formatVolume` function (lines 30-35)
- Delete `volChange` computation (line 39)
- Remove the Vol `<div>` block (lines 83-94), keeping only the RSI portion in that row

### fetch-etf-news edge function
- Add `return_citations: true` to the Perplexity API request body
- Use the `citations` array from Perplexity's response to populate each news item's `url` field with a real, verified link
- If no citation is available for an item, omit the `url` field so the UI can gracefully hide the link icon

